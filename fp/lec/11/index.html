<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Monads. Memoization. Delayed computations. Sequences</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Monads. Memoization. Delayed computations. Sequences</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_thunk_and_delayed_computation">Thunk and delayed computation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Delayed computation is a code put in an anonymous function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">(fun () -&gt; ... )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such anonymous function is commonly called <strong>thunk</strong>. It represents delayed computation, because the code it carries
is not evaluated until you actually call it.</p>
</div>
<div class="paragraph">
<p>For example, one can define:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let t =
  (fun () -&gt;
    let pi = 4.0 *. atan 1.0 in
    let area = pi *. 15.0 *. 15.0 in
    Printf.printf "log: computed area %g\n" area;
    Some area
  )
in</code></pre>
</div>
</div>
<div class="paragraph">
<p>and then call it elsewhere:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">t()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sequence_delayed_functional_iterator">Sequence (Delayed functional iterator)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to create a sequence of elements, but don&#8217;t want to generate the whole thing right away
(maybe because it is too long, possibly even infinite, or because it involves a lot of computation), you can use lazy evaluation, or you can use delayed computation.
We will consider delayed computation case.</p>
</div>
<div class="paragraph">
<p>Define two types, <code>'a seq</code> and <code>'a node</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">type 'a seq = unit -&gt; 'a node
and 'a node =
    Nil
  | Cons of ('a * 'a seq)</code></pre>
</div>
</div>
<div class="paragraph">
<p>These are mutually recursive types, so we use <code>and</code> keyword to define them both simultaneously.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>'a node</code> represents a node of our delayed sequence&#8201;&#8212;&#8201;(head and tail) or empty.</p>
</li>
<li>
<p><code>'a seq</code> is the first node of the sequence stored as a delayed computation.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Iterate over a sequence of integers and print its elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let rec print seq =
  match seq () with
  | Cons (x, rest) -&gt;
      Printf.printf "%i " x;
      print rest
  | Nil -&gt; ()</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the following examples we will use notation <code>(a; b; c)</code> to denote sequence of elements <code>a</code>, <code>b</code>, <code>c</code> .
This is <strong>not real OCaml syntax</strong>, it is only used here to describe what is stored in the sequence.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Infinite constant sequence</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">const n  --&gt;  (n; n; n; ...)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let rec const n =
  (fun () -&gt;
    Cons (n, const (n))
  )</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Infinite sequence of natural numbers <code>(0; 1; 2; 3; &#8230;&#8203;)</code> (not perfect, since it will eventually reach integer overflow):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">nats  --&gt;  (0; 1; 2; 3; ...)</code></pre>
</div>
</div>
<div class="paragraph">
<p> <details><summary style="cursor: pointer; color: #baa;"> &#x1f424; <i>click to open</i> </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let nats =
  let rec seq_ints n =
    (fun () -&gt;
      Cons (n, seq_ints (n+1))
    )
  in
  seq_ints 0</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Take <code>n</code> first elements from <code>seq</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">take 10 nats  --&gt;  (0; 1; 2; 3; 4; 5; 6; 7; 8; 9)</code></pre>
</div>
</div>
<div class="paragraph">
<p> <details><summary style="cursor: pointer; color: #baa;"> &#x1f424; <i>click to open</i> </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let rec take n seq =
  (fun () -&gt;
    if n &gt; 0 then
      match seq() with
      | Cons (x, rest) -&gt; Cons (x, take (n-1) rest)
      | Nil -&gt; Nil
    else
      Nil
  )</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Join two sequences</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">join (take 4 nats) (take 3 (const 0))  --&gt;  (0; 1; 2; 3; 0; 0; 0)

join nats nats |&gt; take 5  --&gt;  (0; 1; 2; 3; 4)
(* note that joining two infinite sequence does not create infinite loop *)</code></pre>
</div>
</div>
<div class="paragraph">
<p> <details><summary style="cursor: pointer; color: #baa;"> &#x1f424; <i>click to open</i> </summary><div> </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let rec join seq1 seq2 =
  (fun () -&gt;
    match seq1 () with
    | Cons (x, rest) -&gt; Cons(x, join rest seq2)
    | Nil -&gt; seq2 ()
  )</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_module_seq">Module Seq</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In OCaml, delayed sequence type is implemented in the standard library in the module <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Seq.html"><code>Seq</code></a>.
All other data types, List, Array, Map, Set, Hashtbl, allow transformation to and from <code>Seq.t</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">module M = Map.Make(String)

let () =
  let fruits = M.empty
    |&gt; M.add "apple" 10
    |&gt; M.add "orange" 7
    |&gt; M.add "grapes" 18
    |&gt; M.add "pineapple" 41
    |&gt; M.add "cherry" 12
  in

  fruits
  |&gt; M.to_seq
  |&gt; Seq.iter (fun (k,v) -&gt;
    Printf.printf "%s %i\n" k v
  );

  print_newline();

  fruits
  |&gt; M.to_seq
  |&gt; Seq.filter (fun (k,v) -&gt; v &gt; 15)
  |&gt; Seq.iter (fun (k,v) -&gt;
    Printf.printf "%s %i\n" k v
  )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>apple 10
cherry 12
grapes 18
orange 7
pineapple 41

grapes 18
pineapple 41</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the elements are sorted by the key (the fruit name). This is because the function <code>M.to_seq</code>
produces the sequence of its key-value pairs sorted by the key (in-order iteration).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_memoization">Memoization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Memoized function caches its return values so that in the future, instead of recomputing it again, it simply looks up for the cached answer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We will use <strong>hash tables</strong> (module <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Hashtbl.html"><code>Hashtbl</code></a>) for caching.
This is an <strong>imperative data structure</strong> with the following operations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Hashtbl.create n</code></dt>
<dd>
<p>creates a new table, where <code>n</code> determines the initial table size.</p>
</dd>
<dt class="hdlist1"><code>Hashtbl.replace ht k v</code> </dt>
<dd>
<p>adds a new key-value pair (<code>k</code>, <code>v</code>) in the table <code>ht</code>. If a binding to the key <code>k</code> already exists, it gets replaced with the new value.</p>
</dd>
<dt class="hdlist1"><code>Hashtbl.find_opt ht k</code> </dt>
<dd>
<p>searches table <code>ht</code> for the value corresponding to the key <code>k</code>. Returns option, <code>None</code> or <code>Some v</code>.</p>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, cached Fibonacci numbers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let fib =
  (* make a hash table for caching *)
  let ht = Hashtbl.create 10 in
  Hashtbl.replace ht 0 0;
  Hashtbl.replace ht 1 1;

  let rec f n =
    match Hashtbl.find_opt ht n with
    | Some v -&gt; v  (* return answer it found *)
    | None -&gt;      (* otherwise: *)
        let v = f (n-1) + f (n-2) in  (* compute *)
        Hashtbl.replace ht n v;       (* save *)
        v                             (* return *)
  in
  f</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">fib 50  --&gt;  12586269025</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_higher_order_functions_for_memoization">Higher-order functions for memoization</h3>
<div class="paragraph">
<p>We can define higher order functions, <code>mem</code>, and <code>mem_rec</code> to turn any function into its memoized version.</p>
</div>
<div class="sect3">
<h4 id="_non_recursive_memoization">Non-recursive memoization</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let mem f =
  let ht = Hashtbl.create 10 in
  ( fun x -&gt;
      try Hashtbl.find ht x with
      | Not_found -&gt;
          let res = f x in
          Hashtbl.replace ht x res;
          res
  )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example: Memoized square roots of integer numbers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let sqrt_of_int = mem (fun x -&gt; sqrt (float x))

sqrt_of_int 123 --&gt; 11.0905365064094177</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_recursive_memoization">Recursive memoization</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let mem_rec f =
  let ht = Hashtbl.create 10 in
  let rec self =
    ( fun x -&gt;
        try Hashtbl.find ht x with
        | Not_found -&gt;
            let res = f self x in
            Hashtbl.replace ht x res;
            res
    )
  in
  self</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example: Memoized Fibonacci numbers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let fib =
  mem_rec
    (fun self n -&gt;
      if n &lt; 2 then n
      else self (n-1) + self (n-2)
    )

fib 50  --&gt;  12586269025</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_additional_resources_and_reading">Additional resources and reading:</h3>
<div class="ulist">
<ul>
<li>
<p>Chapter 8.27</p>
</li>
<li>
<p><a href="http://typeocaml.com/2015/01/25/memoize-rec-untying-the-recursive-knot/">Recursive Memoize &amp; Untying the Recursive Knot</a></p>
</li>
<li>
<p>Real World OCaml: Imperative Programming: <a href="https://dev.realworldocaml.org/imperative-programming.html#scrollNav-5-1">Memoization and Dynamic Programming</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monads">Monads</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consider the following program that reads the filename from
the first command line argument (<code>argv.(1)</code>), and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let get_arg n =
  if Array.length Sys.argv &lt;= n then None
  else Some (Sys.argv.(n))

let open_file filename =
  try
    Some (open_in filename)
  with
  | Sys_error _ -&gt; None

let input_int_opt chan =
  try
    let ib = Scanning.from_channel chan in
    Some (Scanf.bscanf ib "%d" (fun x -&gt; x))
  with
  | _ -&gt; None

let read_int_from_file () =
  match get_arg 1 with
  | None -&gt; None
  | Some filename -&gt;
      begin match open_file filename with
      | None -&gt; None
      | Some chan -&gt;
          begin match input_int_opt chan with
          | None -&gt; None
          | Some int -&gt; Some int
          end
      end

let () =
  match read_int_from_file () with
  | Some x -&gt; Printf.printf "%i\n" x
  | None -&gt; Printf.printf "Error\n"</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_define_a_helper_wrapping_type_a_m">Define a helper wrapping type <code>'a m</code></h3>
<div class="paragraph">
<p>It is implemented as an option type with two additional operations, <code>return</code> and <code>&gt;&gt;=</code> (also called "bind"):</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">type 'a m = 'a option

(*type:  'a -&gt; 'a m  *)
let return x = Some x

(*type:  'a m -&gt; ('a -&gt; 'b m) -&gt; 'b m  *)
let (&gt;&gt;=) am f =
  match am with
  | Some a -&gt; f a
  | None</code></pre>
</div>
</div>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="https://i.imgur.com/sNpepPO.png" alt="sNpepPO" width="">
</div>
</div>
<div class="paragraph">
<p>Using this type (called <strong>Maybe monad</strong>), the <code>read_int_from_file</code> function reduces to much cleaner code</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let read_int_from_file () =
  get_arg 1 &gt;&gt;= open_file &gt;&gt;= input_int_opt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or in a somewhat more verbous, but more explicit way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let read_int_from_file () =
  get_arg 1 &gt;&gt;= fun filename -&gt;
  open_file filename &gt;&gt;= fun chan -&gt;
  input_int_opt chan</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Monads are very useful in pure languages such as Haskell, often for representing imperative computation (state, IO, etc).
However, they are also employed in non-pure languages such as OCaml. Examples include
(see <a href="https://stackoverflow.com/questions/29851449/what-is-the-use-of-monads-in-ocaml">link</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Concurrency (see Lwt and Async libraries)</p>
</li>
<li>
<p>Non-deterministic choice</p>
</li>
<li>
<p>First-class continuations</p>
</li>
<li>
<p>Ambivalent choice and backtracking</p>
</li>
<li>
<p>Parsers</p>
</li>
<li>
<p>Polymorphic state</p>
</li>
<li>
<p>Linear resources</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_additional_resources_and_reading_2">Additional resources and reading:</h3>
<div class="ulist">
<ul>
<li>
<p>Chapters 8.22 - 8.26</p>
</li>
<li>
<p><a href="http://book.realworldhaskell.org/read/monads.html">Intro to monads in Haskell</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lambda_calculus_theoretical_foundation_of_functional_programming">Lambda calculus (Theoretical foundation of functional programming)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lambda calculus is a model of computation introduced by Alonzo Church in 1930s.
It describes computation based on anonymous functions and their application.
It lays the foundation of functional programming and many other fields of
theoretical computer science and mathematical logic.</p>
</div>
<div class="sect2">
<h3 id="_basics">Basics</h3>
<div class="paragraph">
<p>Consider an OCaml anonymous function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">(fun x -&gt; (fun y -&gt; x y))</code></pre>
</div>
</div>
<div class="paragraph">
<p>It takes argument <code>x</code>, then argument <code>y</code>, and then applies <code>x</code> to <code>y</code>.
If we apply this function to two functions <code>(fun w &#8594; w)</code> and <code>u</code>, we will evaluate the whole expression to <code>u</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">     (fun x -&gt; (fun y -&gt; x y)) (fun w -&gt; w) u
--&gt;  (fun y -&gt; (fun w -&gt; w) y) u
--&gt;  (fun w -&gt; w) u
--&gt;  u</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you understand how the above evaluation works, you understand how Lambda calculus works.
It turns out, all computations can be expressed by using this type of function definition (<strong>abstraction</strong>)
and function application (<strong>substitution</strong>).</p>
</div>
<div class="paragraph">
<p>To rewrite the OCaml program in the example above as a Lambda calculus <strong>term</strong>,
we have to do simple syntactic substitution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>replace <code>fun</code> with <code>&#955;</code> (greek lambda), and</p>
</li>
<li>
<p>replace <code>&#8594;</code> with <code>.</code> (period)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So we get:</p>
</div>
<div class="paragraph">
<p><code>(&#955; x . (&#955; y . x y))</code></p>
</div>
<div class="paragraph">
<p>Following the OCaml example above, we can apply this lambda term to <code>(&#955; w . w)</code> and <code>u</code>, and it will reduce to <code>u</code>,
exactly the same way as the OCaml program did:</p>
</div>
<div class="paragraph">
<p><code>(&#955; x . (&#955; y . x y)) (&#955; w . w) u</code><br>
&#8594; <code>(&#955; y . (&#955; w . w) y) u</code><br>
&#8594; <code>(&#955; w . w) u</code><br>
&#8594; <code>u</code></p>
</div>
<div class="paragraph">
<p>The interesting question is: How to express familiar computation primitives
using only lambda terms (anonymous function and their application)?</p>
</div>
</div>
<div class="sect2">
<h3 id="_infinite_loop">Infinite loop</h3>
<div class="paragraph">
<p>Consider the following lambda term <code>(&#955; x . x x)</code>. If you apply it to any other term <code>M</code>, you will get:</p>
</div>
<div class="paragraph">
<p><code>(&#955; x . x x) M</code><br>
&#8594;  <code>M M</code></p>
</div>
<div class="paragraph">
<p>Well, things get interesting if that term <code>M</code> is <code>(&#955; x . x x)</code>, so we get:</p>
</div>
<div class="paragraph">
<p><code>(&#955; x . x x) (&#955; x . x x)</code><br>
&#8594; <code>(&#955; x . x x) (&#955; x . x x)</code><br>
&#8594; <code>(&#955; x . x x) (&#955; x . x x)</code><br>
&#8594; &#8230;&#8203; it will keep doing the same reduction indefinitely.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Such indefinite loop program cannot be run in OCaml, because the type checker will complain about the type of <code>x</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># (fun x -&gt; x x) (fun x -&gt; x x) ;;
Error: This expression has type 'a -&gt; 'b
       but an expression was expected of type 'a
       The type variable 'a occurs inside 'a -&gt; 'b</pre>
</div>
</div>
<div class="paragraph">
<p>In <strong>untyped lambda calculus</strong>, this is not a problem, and that indefinite reduction is a perfectly fine term.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_local_name_binding_let_in_as_lambda_term">Local name binding <code>let in</code> as lambda term</h3>
<div class="paragraph">
<p>Consider the following example of let-in name binding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">let x = y in
f x</code></pre>
</div>
</div>
<div class="paragraph">
<p>I can be rewritten as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ocaml hljs" data-lang="ocaml">(fun x -&gt; f x) y</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, the corresponding lambda term is:</p>
</div>
<div class="paragraph">
<p><code>(&#955; x . f x) y</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_additional_resources_and_reading_3">Additional resources and reading:</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://a-nikolaev.github.io/fp/docs/Harrison1999.pdf">Introduction to Functional Programming</a>, John Harrison (1999)</p>
</li>
<li>
<p><a href="https://a-nikolaev.github.io/fp/docs/Paulson2000.pdf">Foundations of Functional Programming</a>, Lawrence C Paulson (2000)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functional_programming_in_other_languages">Functional Programming in other languages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Aspects of functional programming:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>First-class functions</strong>: functions can be saved in a variable, passed as an argument, or returned from a function.</p>
</li>
<li>
<p><strong>Referential transparency (pure functions)</strong>: function producing no side-effects and returning the same result every time you call it.</p>
</li>
<li>
<p><strong>Tail-call optimization</strong></p>
</li>
<li>
<p><strong>Immutable data</strong>: persistent data types</p>
</li>
<li>
<p><strong>Pattern matching</strong></p>
</li>
<li>
<p><strong>Variant types</strong>: such as Option type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other aspects that are important in functional programming, but not limited to functional paradigm:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Lexical scoping and closures</strong></p>
</li>
<li>
<p><strong>Garbage collection</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Modern general-purpose languages such as Kotlin, Rust, Swift, Clojure, Scala use many functional programming concepts.
Old programming languages, such as Java, and C++, acquire functional-programming features too.</p>
</div>
<div class="sect2">
<h3 id="_javascript">JavaScript</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://medium.com/javascript-scene/why-learn-functional-programming-in-javascript-composing-software-ea13afc7a257">Why Learn Functional Programming in JavaScript?</a></p>
</li>
<li>
<p><a href="https://hackernoon.com/functional-programming-in-javascript-is-an-antipattern-58526819f21e">Functional programming in Javascript is an antipattern</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=m3svKOdZijA">Hey Underscore, You&#8217;re Doing It Wrong!</a> - video on functional JS on why in functional code you put
a collection argument last, currying, and <a href="https://en.wikipedia.org/wiki/Tacit_programming">point-free programming</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>JavaScript</strong> was created as a mix of Scheme and Self with a Java-style syntax. It had first-class functions from the very beginning,
however its type system is too permissive to develop safe and robust code. It resulted in development of
better functional languages such as <a href="https://www.typescriptlang.org/">TypeScript</a> and Clojure (<a href="https://clojurescript.org/">ClojureScript</a>) that compile into JS,
and new libraries such as <a href="https://immutable-js.github.io/immutable-js/">Immutable.js</a>,
<a href="https://github.com/lodash/lodash/wiki/FP-Guide">lodash/fp</a>, and <a href="https://ramdajs.com/">Ramda</a> to provide other functional programming features in JavaScript.</p>
</div>
<div class="paragraph">
<p>OCaml compiles to JS too, using compilers <strong>js_of_ocaml</strong> (also called JSOO) and <strong>BuckleScript</strong>. Programming language <strong>Reason ML</strong> is an alternative syntax for
OCaml that is designed for better interoperability with JavaScript, relying on BuckleScript compiler.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-04-18 22:18:14 -0400
</div>
</div>
<link rel="stylesheet" href="../highlight/styles/github.min.css">
<script src="../highlight/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>